<!doctype html>
<html>

<head>
    <meta charset="utf-8" />
    <title>Load tool</title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" />
    <link rel="stylesheet" media="all" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css" />
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>
    <style type="text/css">
        .navbar-default {
            background-color: #00bcd4;
            border-radius: 0px;
            border: 0px solid #00bcd4;
        }
        .navbar-default .navbar-brand {
            color: #fff;
        }
        .navbar-default .navbar-brand:hover {
            color: #fff;
        }
        .navbar-default .navbar-nav>li>a {
            color: #fff;
        }
        .navbar-default .navbar-nav>li>a:hover,
        .navbar-default .navbar-nav>li>a:hover:active {
            color: #fff;
        }
        .navbar-default .navbar-nav>li:hover,
        .navbar-default .navbar-nav>li:active,
        .navbar-default .navbar-nav>.active>a:hover {
            color: #fff;
            background-color: #4dd0e1;
        }
        .testFrame {
            width: 100%;
            height: 1024px;
            border: 1px solid #efefef;
            padding: 0px;
            margin: 0px;
        }
        #iframeContainer {
            margin-top: 100px;
        }
        #benchmarkResult {
            margin-top: 30px;
        }
        #statusContainer {
            margin-top: 15px;
        }
        .navbar-default .navbar-nav>.active>a {
            color: #fff;
            background-color: #00acc1;
        }
        .help-image {
            border: 1px solid #efefef;
            padding: 2px;
            max-width: 600px;
        }
        .alert-note {
            border-left: 4px solid #00bcd4!important;
            border: 1px solid #efefef;
        }
        .alexa, .alexa:hover, .alexa:focus {
            border-bottom: 1px dashed #337ab7;
            padding-bottom: 1px;
            text-decoration: none;
        }
    </style>
    <script type="text/javascript">
        var alexTopSites = {
            
            "news": [
                "https://www.reddit.com/",
                "https://cnn.com",
                "https://nytimes.com",
                "https://theguardian.com",
                "https://washingtonpost.com",
                "https://bbc.co.uk/news/",
                "https://huffingtonpost.com",
                "https://indiatimes.com",
                "https://news.yahoo.com",
                "https://weather.com",
                "https://news.google.com/",
                "https://forbes.com",
                "https://foxnews.com",
                "https://shutterstock.com",
                "https://accuweather.com",
                "https://bloomberg.com",
                "https://timesofindia.indiatimes.com",
                "https://reuters.com",
                "https://wsj.com",
                "https://usatoday.com",
                "https://money.cnn.com",
                "https://wunderground.com",
                "https://cnbc.com",
                "https://drudgereport.com",
                "https://chron.com",
                "https://nbcnews.com",
                "https://time.com",
                "https://latimes.com",
                "https://chinadaily.com.cn",
                "https://usnews.com",
                "https://economictimes.indiatimes.com",
                "https://nypost.com",
                "https://thehill.com",
                "https://theatlantic.com",
                "https://indianexpress.com",
                "https://cbsnews.com",
                "https://news.com.au",
                "https://abcnews.go.com",
                "https://hindustantimes.com",
                "https://nationalgeographic.com",
                "https://sfgate.com",
                "https://thehindu.com",
                "https://dw.com",
                "https://cbc.ca/news/",
                "https://weather.gov",
                "https://thedailybeast.com",
                "https://hollywoodreporter.com",
                "https://topix.com",
                "https://smh.com.au",
                "https://alarabiya.net"
            ],

            "sports": [
                "https://espn.com",
                "https://cricbuzz.com",
                "https://espncricinfo.com",
                "https://nba.com",
                "https://sports.yahoo.com",
                "https://livescore.com",
                "https://goal.com",
                "https://bleacherreport.com",
                "https://nhl.com",
                "https://cbssports.com",
                "https://bbc.com/sport",
                "https://espn.com/mlb/",
                "https://strava.com",
                "https://flashscore.com",
                "https://premierleague.com",
                "https://iplt20.com",
                "https://deadspin.com",
                "https://skysports.com",
                "https://nfl.com",
                "https://wwe.com",
                "https://bbc.com/sport/football",
                "https://nbcsports.com",
                "https://rei.com",
                "https://ncaa.com",
                "https://baseball.fantasysports.yahoo.com",
                "https://soccerway.com",
                "https://sbnation.com",
                "https://espn.com/nfl/",
                "https://mlb.mlb.com",
                "https://foxsports.com",
                "https://si.com",
                "https://skysports.com/football",
                "https://espn.com/nhl/",
                "https://espn.com/mens-college-basketball/",
                "https://espnfc.us",
                "https://uefa.com",
                "https://formula1.com",
                "https://tsn.ca",
                "https://filgoal.com",
                "https://rotoworld.com",
                "https://masters.com",
                "https://rivals.com",
                "https://baseball-reference.com",
                "https://basketball-reference.com",
                "https://fifa.com",
                "https://eurosport.com",
                "https://givemesport.com",
                "https://football365.com",
                "https://motorsport.com",
                "https://atpworldtour.com"
            ],

            "games": [
                "https://twitch.tv",
                "https://roblox.com",
                "https://store.steampowered.com",
                "https://battle.net",
                "https://ign.com",
                "https://gamefaqs.com",
                "https://leagueoflegends.com",
                "https://www.playstation.com/",
                "https://wowhead.com",
                "https://unity3d.com",
                "https://gamespot.com",
                "https://runescape.wikia.com",
                "https://ea.com",
                "https://chess.com",
                "https://pcgamer.com",
                "https://xbox.com",
                "https://kongregate.com",
                "https://ign.com/wikis",
                "https://icy-veins.com",
                "https://miniclip.com",
                "https://nexusmods.com",
                "https://freelotto.com",
                "https://teamliquid.net",
                "https://nvidia.com",
                "https://mmo-champion.com",
                "https://minecraft.net/",
                "https://curse.com",
                "https://rockstargames.com",
                "https://nintendo.com",
                "https://eurogamer.net",
                "https://pch.com",
                "https://boardgamegeek.com",
                "https://blizzard.com",
                "https://square-enix.com",
                "https://sporcle.com",
                "https://minecraftforum.net",
                "https://wizards.com",
                "https://bulbagarden.net",
                "https://giantbomb.com",
                "https://www.bet-at-home.com/",
                "https://finalfantasyxiv.com",
                "https://itch.io",
                "https://diablofans.com",
                "https://www.ubisoft.com/",
                "https://planetminecraft.com",
                "https://dorkly.com",
                "https://thesimsresource.com",
                "https://runescape.com",
                "https://bungie.net",
                "https://elderscrolls.wikia.com"
            ],

            "computers": [
                "https://google.com",
                "https://www.youtube.com/",
                "https://facebook.com",
                "https://mail.google.com/",
                "https://yahoo.com",
                "https://docs.google.com/",
                "https://en.wikipedia.org",
                "https://twitter.com/",
                "https://search.yahoo.com",
                "https://www.linkedin.com/",
                "https://mail.yahoo.com",
                "https://imgur.com",
                "https://wordpress.com",
                "https://www.bing.com/",
                "https://msn.com",
                "https://tumblr.com",
                "https://www.microsoft.com/",
                "https://stackoverflow.com",
                "https://office.com",
                "https://www.pinterest.com/",
                "https://github.com/",
                "https://apple.com",
                "https://wikia.com",
                "https://paypal.com",
                "https://adobe.com",
                "https://www.dropbox.com/",
                "https://play.google.com/",
                "https://plus.google.com",
                "https://soundcloud.com",
                "https://ask.com",
                "https://vimeo.com/",
                "https://blogger.com",
                "https://salesforce.com",
                "https://slideshare.net",
                "https://cnet.com",
                "https://mediafire.com",
                "https://www.mozilla.org/",
                "https://wikihow.com",
                "https://godaddy.com",
                "https://huffingtonpost.com",
                "https://support.microsoft.com",
                "https://trello.com",
                "https://myway.com",
                "https://intuit.com",
                "https://mega.nz/",
                "https://livejournal.com",
                "https://www.google.com/adsense/",
                "https://archive.org/",
                "https://msdn.microsoft.com",
                "https://feedly.com"
            ],

            "business": [
                "https://office.com",
                "https://paypal.com",
                "https://espn.com",
                "https://www.chase.com/",
                "https://indeed.com",
                "https://alibaba.com",
                "https://bankofamerica.com",
                "https://wellsfargo.com",
                "https://zillow.com",
                "https://forbes.com",
                "https://skype.com",
                "https://shutterstock.com",
                "https://businessinsider.com",
                "https://scribd.com",
                "https://samsung.com",
                "https://finance.yahoo.com",
                "https://behance.net",
                "https://hdfcbank.com",
                "https://bloomberg.com",
                "https://capitalone.com",
                "https://target.com",
                "https://americanexpress.com",
                "https://www.ups.com/",
                "https://wiley.com",
                "https://icicibank.com",
                "https://reuters.com",
                "https://fedex.com",
                "https://wsj.com",
                "https://irs.gov",
                "https://onlinelibrary.wiley.com",
                "https://springer.com",
                "https://hm.com",
                "https://investopedia.com",
                "https://att.com",
                "https://money.cnn.com",
                "https://adp.com",
                "https://www.techcrunch.com/",
                "https://webex.com",
                "https://verizonwireless.com",
                "https://eventbrite.com",
                "https://realtor.com",
                "https://merriam-webster.com",
                "https://cisco.com",
                "https://thesun.co.uk",
                "https://intel.com",
                "https://discover.com",
                "https://fidelity.com",
                "https://investing.com",
                "https://economictimes.indiatimes.com",
                "https://nypost.com"
            ],

            "society": [
                "https://answers.yahoo.com",
                "https://nih.gov",
                "https://siteadvisor.com",
                "https://irs.gov",
                "https://patreon.com",
                "https://europa.eu",
                "https://jw.org",
                "https://post.japanpost.jp",
                "https://biblegateway.com",
                "https://ancestry.com",
                "https://state.gov",
                "https://slate.com",
                "https://www.change.org/",
                "https://correios.com.br",
                "https://ec.europa.eu",
                "https://lds.org",
                "https://complex.com",
                "https://match.com",
                "https://jezebel.com",
                "https://un.org",
                "https://who.int",
                "https://digg.com",
                "https://legacy.com",
                "https://collegeboard.org",
                "https://thrillist.com",
                "https://biblehub.com",
                "https://salon.com",
                "https://cosmopolitan.com",
                "https://infowars.com",
                "https://www.theknot.com/",
                "https://dailykos.com",
                "https://worldbank.org",
                "https://soompi.com",
                "https://sulekha.com",
                "https://menshealth.com",
                "https://gq.com",
                "https://snopes.com",
                "https://fao.org",
                "https://www.ssa.gov/",
                "https://plos.org",
                "https://google.com/patents",
                "https://royalmail.com",
                "https://hi5.com",
                "https://companieshouse.gov.uk",
                "https://esquire.com",
                "https://interpals.net",
                "https://biography.com",
                "https://bbb.org",
                "https://westlaw.com",
                "https://imdb.com/news/"
            ],

            "shopping": [
                "https://amazon.com",
                "https://netflix.com",
                "https://ebay.com",
                "https://amazon.co.uk",
                "https://www.etsy.com/",
                "https://store.steampowered.com",
                "https://walmart.com",
                "https://ikea.com",
                "https://bestbuy.com",
                "https://homedepot.com",
                "https://target.com",
                "https://wiley.com",
                "https://nike.com",
                "https://cambridge.org",
                "https://www.groupon.com/",
                "https://hm.com",
                "https://www.humblebundle.com/",
                "https://newegg.com",
                "https://bodybuilding.com",
                "https://nordstrom.com",
                "https://macys.com",
                "https://lowes.com",
                "https://bhphotovideo.com",
                "https://ticketmaster.com",
                "https://zappos.com",
                "https://costco.com",
                "https://kohls.com",
                "https://gap.com",
                "https://wayfair.com",
                "https://urbanoutfitters.com",
                "https://forever21.com",
                "https://sephora.com",
                "https://sky.com",
                "https://gamestop.com",
                "https://overstock.com",
                "https://oup.com",
                "https://redbubble.com",
                "https://rei.com",
                "https://backpage.com",
                "https://autotrader.com",
                "https://staples.com",
                "https://iherb.com",
                "https://google.com/shopping",
                "https://6pm.com",
                "https://walgreens.com",
                "https://jcpenney.com",
                "https://sears.com",
                "https://barnesandnoble.com",
                "https://adidas.com/us/",
                "https://jcrew.com"
            ],

            "reference": [
                "https://stackoverflow.com",
                "https://answers.yahoo.com",
                "https://nlm.nih.gov",
                "https://thesaurus.com",
                "https://wordreference.com",
                "https://archive.org/",
                "https://blackboard.com",
                "https://goodreads.com",
                "https://mit.edu",
                "https://urbandictionary.com",
                "https://www.udemy.com/",
                "https://thefreedictionary.com",
                "https://wiktionary.org",
                "https://cambridge.org",
                "https://investopedia.com",
                "https://dictionary.cambridge.org",
                "https://stanford.edu",
                "https://www.coursera.org/",
                "https://merriam-webster.com",
                "https://harvard.edu",
                "https://dict.cc",
                "https://psu.edu",
                "https://ecollege.com",
                "https://berkeley.edu",
                "https://spanishdict.com",
                "https://ed.gov",
                "https://www.edx.org/",
                "https://answers.com",
                "https://en.wiktionary.org",
                "https://umich.edu",
                "https://purdue.edu",
                "https://elsevier.com",
                "https://stumbleupon.com",
                "https://lynda.com",
                "https://cornell.edu",
                "https://wisc.edu",
                "https://illinois.edu",
                "https://utexas.edu",
                "https://ebscohost.com",
                "https://washington.edu",
                "https://dict.leo.org",
                "https://ucla.edu",
                "https://nyu.edu",
                "https://oup.com",
                "https://columbia.edu",
                "https://whitepages.com",
                "https://yourdictionary.com",
                "https://udacity.com",
                "https://oxforddictionaries.com",
                "https://brainyquote.com"
            ]
        };

        var now = function() {
            return (new Date()).getTime();
        };

        var coalesce = function(value, defaultValue) {
            if (typeof value == "undefined" || value == null) {
                return defaultValue;
            }

            return value;
        };

        var logDebug = function(message) {
            if (console && console.log) {
                console.log(message);
            }
        };

        var Benchmark = function(params) {

            // Current iteration number
            this.iterationNumber = 1;
            // Iterations results
            this.result = [];

            // Shows benchmark results
            this.showBenchmarkResult = function() {
                $('#iframeContainer').children().remove();
                $('#benchmarkResult table>tbody tr').remove();
                this.setStatus();

                var elapsedLoadSum = 0;

                for (var i = 0; i < this.result.length; i++) {
                    var iterationResult = this.result[i];
                    var elapsedLoad = iterationResult.load - iterationResult.startTime;
                    elapsedLoadSum += elapsedLoad;

                    var row = $('<tr>');
                    row.append($('<th>').text(iterationResult.iterationNumber));
                    row.append($('<td>').text(iterationResult.url));
                    row.append($('<td>').text(elapsedLoad));

                    $('#benchmarkResult table>tbody').append(row);
                }

                var averageRow = $('<tr>');
                averageRow.append($('<th>').text('Average:'));
                averageRow.append($('<th colspan="2">').text(Math.round(elapsedLoadSum / this.result.length)));
                var overallRow = $('<tr>');
                overallRow.append($('<th>').text('Overall:'));
                overallRow.append($('<th colspan="2">').text(elapsedLoadSum));
                $('#benchmarkResult table>tbody').append(averageRow);
                $('#benchmarkResult table>tbody').append(overallRow);
                $('#benchmarkResult').removeClass('hide');
            };

            /**
             * Shows current status of the benchmark run
             */
            this.setStatus = function(title, message) {
                $('#statusContainer').children().remove();
                if (title) {
                    $('#statusContainer').append('<h4>' + title + '</h4>');
                }
                if (message) {
                    $('#statusContainer').append('<p>' + message + '</p>');
                }
            };

            /**
             * Loads frame and records iteration results
             * @param url Test url
             */
            this.loadFrame = function(url) {
                var iframeContainer = $('#iframeContainer');
                iframeContainer.children().remove();
                var testFrame = $('<iframe>').addClass('testFrame');
                testFrame.attr('src', url);
                iframeContainer.append(testFrame);

                var startTime = (new Date()).getTime();
                var iterationResult = {
                    url: url,
                    iterationNumber: this.iterationNumber,
                    startTime: now()
                };
                this.result.push(iterationResult);

                this.setStatus('Iteration #' + this.iterationNumber, 'Waiting for page ' + url + ' to load...');
                var self = this;

                var onLoad = function() {
                	if (iterationResult.load) {
                		// Already loaded
                		return;
                	}

                    // Frame fully loaded time
                    iterationResult.load = now();

                    var elapsed = iterationResult.load - iterationResult.startTime;
                    var message = 'Page has been loaded for ' + elapsed + ' ms. Waiting 2 seconds before the next iteration.';
                    self.setStatus('Iteration #' + self.iterationNumber, message);

                    self.iterationNumber++;
                    // Wait for 2 secs before running next time
                    setTimeout(function() {
                        self.run();
                    }, 2000);
                };

                // Max timeout -- 10 seconds
                setTimeout(function() {
                	onLoad();
                }, 10 * 1000);

                $(testFrame).on('load', function() {
                	onLoad();
                });
            };

            /**
             * Runs the benchmark
             */
            this.run = function() {
                var iterationsCount = params.repeatCount * params.urls.length;
                if (this.iterationNumber > iterationsCount) {
                    logDebug('Benchmark finished');
                    this.showBenchmarkResult();
                    params.complete();
                    return;
                }

                logDebug('Run iteration ' + this.iterationNumber);
                var urlIndex = Math.floor((this.iterationNumber - 1) / params.repeatCount);
                var url = params.urls[urlIndex];
                this.loadFrame(url);
            };
        };

        $(function() {

            $('a.alexa').on('click', function() {
                var category = $(this).attr('data-category');
                var sites;

                if (category === 'all') {
                    sites = [];
                    Object.keys(alexTopSites).forEach(function(key) {
                        sites = sites.concat(alexTopSites[key]);
                    });
                } else {
                    sites = alexTopSites[category];
                }

                $('#testWebsites').val(sites.join('\n'));
            });

            var formBenchmarkParameters = $('#formBenchmarkParameters');
            formBenchmarkParameters.on('submit', function(e) {
                e.preventDefault();

                var btnStart = $('#btnStart');
                if (btnStart.hasClass('active')) {
                    logDebug('Ignore click, test is in progress');
                } else {
                    var urls = $('#testWebsites').val().split('\n');
                    // Remove empty elements
                    urls = $.grep(urls, function(n) {
                        return (n.trim());
                    });

                    if (!urls || urls.length == 0) {
                        alert('Enter test websites');
                        return;
                    }

                    var params = {
                        repeatCount: $('#repeatCount').val(),
                        urls: urls,
                        complete: function() {
                            btnStart.removeClass('active');
                            btnStart.text('Start!');
                            formBenchmarkParameters.find('input').removeAttr('disabled');
                        }
                    };

                    $('#benchmarkResult').addClass('hide');
                    btnStart.addClass('active');
                    btnStart.text('Processing...');
                    formBenchmarkParameters.find('input').attr('disabled', 'true');

                    var benchmark = new Benchmark(params);
                    benchmark.run();
                }

                return false;
            });
        });
    </script>
</head>

<body>
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Load tool</h1>
                <p>
                    A simple tool for browser load testing.
                </p>
                <p>
                    Enter test websites manually or use predefined sets.<br/>
                    Alexa Top 50 for category:
                    <a href="javascript:void(0)" class="alexa" data-category="news">News</a>,
                    <a href="javascript:void(0)" class="alexa" data-category="sports">Sports</a>,
                    <a href="javascript:void(0)" class="alexa" data-category="games">Games</a>,
                    <a href="javascript:void(0)" class="alexa" data-category="computers">Computers</a>,
                    <a href="javascript:void(0)" class="alexa" data-category="business">Business</a>,
                    <a href="javascript:void(0)" class="alexa" data-category="society">Society</a>,
                    <a href="javascript:void(0)" class="alexa" data-category="shopping">Shopping</a>,
                    <a href="javascript:void(0)" class="alexa" data-category="reference">Reference</a>,
                    <a href="javascript:void(0)" class="alexa" data-category="all">All categories combined</a>
                </p>
                <div class="alert alert-note">
                    <strong>Not every website is suitable for this test.</strong> Some websites may deny loading in frames, for instance <u>nytimes.com</u>.
                </div>
                <form class="form-horizontal" id="formBenchmarkParameters">
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="testWebsites">Test websites:</label>
                        <div class="col-sm-8">
                            <textarea class="form-control" id="testWebsites" rows="8" name="testWebsites" placeholder="Enter test websites" required></textarea>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="col-sm-2 control-label" for="repeatCount">Repeat count: </label>
                        <div class="col-sm-3">
                            <input type="number" class="form-control" id="repeatCount" placeholder="99" required />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-sm-offset-2 col-sm-10">
                            <button id="btnStart" type="submit" class="btn btn-primary btn-lg">Start test</button>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="row">
            <div class="col-md-12" id="statusContainer">
            </div>
        </div>
        <div class="row">
            <div class="col-md-12 hide" id="benchmarkResult">
                <h3>Benchmark Result</h3>
                <table class="table table-striped">
                    <thead>
                        <tr>
                            <th>#</th>
                            <th>Address</th>
                            <th>Elapsed on page load, ms</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <th>1</th>
                            <th>https://trattatata.com/</th>
                            <td>1321</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12" id="iframeContainer">

            </div>
        </div>
    </div>
</body>

</html>
